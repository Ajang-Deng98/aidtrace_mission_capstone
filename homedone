# AidTrace Setup Guide

## Complete Installation and Setup Instructions

### Prerequisites

1. **Python 3.9+**
   - Download from https://www.python.org/downloads/
   - Verify: `python --version`

2. **Node.js 16+**
   - Download from https://nodejs.org/
   - Verify: `node --version` and `npm --version`

3. **PostgreSQL 13+**
   - Download from https://www.postgresql.org/download/
   - Create database: `aidtrace_db`
   - Default credentials: username=postgres, password=postgres

4. **Ganache**
   - Download from https://trufflesuite.com/ganache/
   - Start Ganache on port 7545

---

## Step 1: Database Setup

1. Open PostgreSQL command line or pgAdmin
2. Create database:
```sql
CREATE DATABASE aidtrace_db;
```

---

## Step 2: Backend Setup

1. Navigate to backend directory:
```bash
cd backend
```

2. Create virtual environment:
```bash
python -m venv venv
```

3. Activate virtual environment:
```bash
# Windows
venv\Scripts\activate

# Mac/Linux
source venv/bin/activate
```

4. Install dependencies:
```bash
pip install -r requirements.txt
```

5. Update database settings in `backend/aidtrace/settings.py`:
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'aidtrace_db',
        'USER': 'postgres',
        'PASSWORD': 'your_password',  # Change this
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

6. Run migrations:
```bash
python manage.py makemigrations
python manage.py migrate
```

7. Create admin user:
```bash
python manage.py create_admin
```
This creates: username=admin, password=admin123

8. Start backend server:
```bash
python manage.py runserver
```
Backend will run on http://localhost:8000

---

## Step 3: Blockchain Setup

1. Start Ganache on port 7545

2. Navigate to blockchain directory:
```bash
cd blockchain
```

3. Install dependencies:
```bash
npm install
```

4. Deploy smart contract:
```bash
npx truffle migrate --reset
```

5. Copy the deployed contract address from the output

6. Update contract address:
   - In `backend/aidtrace/settings.py`: Set `CONTRACT_ADDRESS`
   - In `frontend/.env`: Set `REACT_APP_CONTRACT_ADDRESS`

---

## Step 4: Frontend Setup

1. Navigate to frontend directory:
```bash
cd frontend
```

2. Install dependencies:
```bash
npm install
```

3. Create `.env` file:
```bash
REACT_APP_CONTRACT_ADDRESS=your_contract_address_here
```

4. Start frontend:
```bash
npm start
```
Frontend will run on http://localhost:3000

---

## Step 5: Testing the System

### Access Points:
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000/api
- Admin Panel: http://localhost:8000/admin

### Test Accounts:

**Admin:**
- Username: admin
- Password: admin123

**Create Test Users:**
1. Go to http://localhost:3000/register
2. Register as Donor, NGO, or Supplier
3. Field Officers are created by NGO users

---

## Step 6: Complete Workflow Test

### 1. Register Users
- Register 1 NGO user
- Register 1 Donor user
- Register 1 Supplier user

### 2. NGO Creates Project
- Login as NGO
- Create a new project with required items
- Project is stored on blockchain

### 3. NGO Creates Field Officer
- Go to Field Officers page
- Create a field officer account

### 4. Donor Funds Project
- Login as Donor
- View available projects
- Fund a project with digital signature
- Wait for NGO confirmation

### 5. NGO Confirms Funding
- Login as NGO
- View project details
- Confirm funding with digital signature
- Funding receipt stored on blockchain

### 6. NGO Assigns Supplier
- Select supplier from list
- Assign items to supplier

### 7. Supplier Confirms
- Login as Supplier
- View assignment
- Confirm with digital signature
- Confirmation stored on blockchain

### 8. NGO Assigns Field Officer
- Assign field officer to project

### 9. Field Officer Confirms
- Login as Field Officer
- Confirm receipt from supplier
- Sign confirmation (stored on blockchain)

### 10. Field Officer Distributes Aid
- Add beneficiaries (name, phone)
- Search for beneficiary
- Perform mock face scan (always returns true)
- Send OTP to beneficiary phone
- Verify OTP code
- Complete distribution (NOT on blockchain)

### 11. Admin Oversight
- Login as Admin
- View all users, projects, and reports

---

## Troubleshooting

### Database Connection Error
- Verify PostgreSQL is running
- Check database credentials in settings.py
- Ensure database `aidtrace_db` exists

### Blockchain Connection Error
- Verify Ganache is running on port 7545
- Check contract address is correctly set
- Redeploy contract if needed

### Frontend API Error
- Verify backend is running on port 8000
- Check CORS settings in backend
- Clear browser cache

### Migration Errors
```bash
python manage.py makemigrations --empty api
python manage.py migrate --fake
```

---

## Project Structure

```
aidtrace_project/
├── backend/
│   ├── aidtrace/          # Django settings
│   ├── api/               # Main API app
│   │   ├── models.py      # Database models
│   │   ├── views.py       # API endpoints
│   │   ├── serializers.py # Data serializers
│   │   ├── auth.py        # Authentication
│   │   ├── blockchain.py  # Blockchain service
│   │   └── otp_service.py # OTP handling
│   └── manage.py
├── frontend/
│   ├── src/
│   │   ├── pages/         # Dashboard pages
│   │   ├── services/      # API services
│   │   └── App.js
│   └── package.json
├── blockchain/
│   ├── contracts/         # Smart contracts
│   │   └── AidTrace.sol
│   ├── migrations/        # Deployment scripts
│   └── truffle-config.js
└── README.md
```

---

## API Endpoints

### Authentication
- POST `/api/register/` - Register new user
- POST `/api/login/` - Login

### Public
- POST `/api/public-reports/` - Submit report
- GET `/api/public-reports/list/` - Get all reports

### NGO
- POST `/api/ngo/projects/` - Create project
- GET `/api/ngo/projects/list/` - Get NGO projects
- GET `/api/ngo/dashboard/` - Get dashboard stats
- POST `/api/ngo/field-officers/` - Create field officer
- POST `/api/ngo/assign-supplier/` - Assign supplier
- POST `/api/ngo/assign-field-officer/` - Assign field officer
- POST `/api/ngo/confirm-funding/` - Confirm funding

### Donor
- GET `/api/donor/projects/` - Get all projects
- POST `/api/donor/fund-project/` - Fund project
- GET `/api/donor/project/:id/` - Get project details

### Supplier
- GET `/api/supplier/assignments/` - Get assignments
- POST `/api/supplier/confirm/` - Confirm assignment

### Field Officer
- GET `/api/field-officer/assignments/` - Get assignments
- POST `/api/field-officer/confirm/` - Confirm handover
- POST `/api/field-officer/face-scan/` - Mock face scan
- POST `/api/field-officer/send-otp/` - Send OTP
- POST `/api/field-officer/verify-otp/` - Verify OTP

### Admin
- GET `/api/admin/users/` - Get all users
- GET `/api/admin/dashboard/` - Get admin stats
- GET `/api/admin/projects/` - Get all projects

---

## Notes

- Mock face scan always returns TRUE
- OTP is printed in console (for development)
- Blockchain is used only for: project creation, funding receipts, supplier confirmation, field officer confirmation
- Distribution process does NOT use blockchain
- Admin account cannot be created through registration

---

## Support

For issues or questions, check:
1. All services are running (PostgreSQL, Ganache, Backend, Frontend)
2. Database migrations are applied
3. Contract is deployed and address is set
4. Dependencies are installed correctly
